<?xml version="1.0" encoding="UTF-8" ?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Reminder_to_Book_Flights</name>
        <label>Send Reminder to Book Flights</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference
        >var_Email_Address_Collection</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressCollection</name>
            <value>
                <elementReference
        >var_cc_Email_Address_Collection</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>salesforce@erepublic.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>tt_Email_Subject_Line</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>tt_Email_Body</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
        <versionString>2.0.1</versionString>
    </actionCalls>
    <apiVersion>64.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_carbon_copy_recipients</name>
        <label>Assign carbon copy recipients</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference
      >var_cc_Email_Address_Collection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference
        >$Record.Event_Manager__r.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference
      >var_cc_Email_Address_Collection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference
        >$Record.Event_Admin_Coordinator__r.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference
      >var_cc_Email_Address_Collection</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>salesforce@erepublic.com</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Send_Reminder_to_Book_Flights</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Email_Collection</name>
        <label>Assign Email Collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>var_Email_Address_Collection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference
        >Loop_through_Onsite_Staff.Internal_Contact__r.Email</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_Onsite_Staff</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Event_is_in_10_Weeks</name>
        <label>Event is in 10 Weeks?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Event_in_10_Weeks_Send_Flight_Notice</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference
        >f_Event_Start_Minus_70_Days</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDate</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference
        >Get_Onsite_Staff_Event_Contact_Roles</targetReference>
            </connector>
            <label>Yes, Event in 10 Weeks; Send Flight Notice</label>
        </rules>
    </decisions>
    <description
  >Checks daily if the event takes place in 45 days. If so, sends a reminder to onsite staff to book their flights.</description>
    <environments>Default</environments>
    <formulas>
        <name>f_Event_Start_Date</name>
        <dataType>String</dataType>
        <expression
    >TEXT(MONTH({!$Record.Event_Start_Date__c})) &amp; &quot;/&quot; &amp;
TEXT(DAY({!$Record.Event_Start_Date__c})) &amp; &quot;/&quot; &amp;
TEXT(YEAR({!$Record.Event_Start_Date__c}))</expression>
    </formulas>
    <formulas>
        <name>f_Event_Start_Minus_70_Days</name>
        <dataType>Date</dataType>
        <expression>{!$Record.Event_Start_Date__c}-70</expression>
    </formulas>
    <interviewLabel
  >Event or Conference - ST - Reminder to Book Flights {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Event or Conference - ST - Reminder to Book Flights</label>
    <loops>
        <name>Loop_through_Onsite_Staff</name>
        <label>Loop through Onsite Staff</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference
    >Get_Onsite_Staff_Event_Contact_Roles</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Email_Collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Assign_carbon_copy_recipients</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Onsite_Staff_Event_Contact_Roles</name>
        <label>Get Onsite Staff - Event Contact Roles</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound
    >false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_Onsite_Staff</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Event__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Internal_Contact__c</field>
            <operator>NotEqualTo</operator>
        </filters>
        <filters>
            <field>Role__c</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Onsite</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Event_Contact_Role__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Event_is_in_10_Weeks</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Cancelled</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>01230000000ueuwAAA</stringValue>
            </value>
        </filters>
        <filters>
            <field>Assigned_Onsite_Staff__c</field>
            <operator>GreaterThan</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>Event_Start_Date__c</field>
            <operator>NotEqualTo</operator>
        </filters>
        <object>Events__c</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2025-09-17</startDate>
            <startTime>05:00:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>tt_Email_Body</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text
    >&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;div style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;&lt;span style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;Hello Team!&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;You are currently listed as an Onsite Staff Member for &lt;a href=&quot;https://erepublic.lightning.force.com/lightning/r/Events__c/{!$Record.Id}/view&quot;&gt;{!$Record.Name}&lt;/a&gt;, which is taking place in (10) weeks, on &lt;b&gt;{!f_Event_Start_Date}&lt;/b&gt;. &lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;&lt;span style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;If needed and you haven&apos;t already, please be sure to secure your flight.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;Thank you!&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;&lt;span style=&quot;font-size:11pt;font-family:Arial;line-height:120%;&quot;&gt;&lt;b&gt;{!$Record.Event_Manager__r.FirstName} {!$Record.Event_Manager__r.LastName}&lt;/b&gt;&lt;br&gt;{!$Record.Event_Manager__r.Title}&lt;br&gt;&lt;a href=&quot;mailto:{!$Record.Event_Manager__r.Email}&quot;&gt;{!$Record.Event_Manager__r.Email}&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size:7pt;font-family:Arial;line-height:120%;&quot;&gt;&lt;a href=&quot;https://erepublic.lightning.force.com/lightning/r/FlowRecord/2aFJw00000090VSMAY/view&quot;&gt;Flow&lt;/a&gt;&lt;/span&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>tt_Email_Subject_Line</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Reminder to Book your Flight: {!$Record.Name}</text>
    </textTemplates>
    <variables>
        <name>var_cc_Email_Address_Collection</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>var_Email_Address</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>var_Email_Address_Collection</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
