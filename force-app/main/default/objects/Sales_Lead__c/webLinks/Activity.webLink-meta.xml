<?xml version="1.0" encoding="UTF-8" ?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Activity</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Activity</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&apos;//code.jquery.com/jquery-2.0.3.min.js&apos;)}

 var URL = &quot;https://cms.erepublic.com/common/salesforce/salesforce_api/contact_short_history_modal/?Id={!Sales_Lead__c.ContactId__c}&quot;;

 function doRequest() {
        jQuery.ajax({
           type: &quot;GET&quot;,
           url: &quot;/services/proxy&quot;,
           cache: false,
           headers: {
             &quot;SalesforceProxy-Endpoint&quot; : URL
           },
           success : function(response) {
             var res = JSON.parse(response);
             if( res.JavaScript ) {
               eval(res.JavaScript);
             } else {
               console.log(res);
             }
           },
           error : function(response) {
             if( response.statusText.match(/Unable to forward request due to: Read timed out/gi) ) {
               // a timeout here means the CMS took too long calculating the history. That can happen!
               doRequest();
             } else {
               alert(&quot;Failed&quot; + JSON.stringify(response));
             }
           }
        });
      }
      doRequest();</url>
</WebLink>
